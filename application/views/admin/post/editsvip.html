<{extends 'admin/templates/base.html'}>

<{block name = title}>编辑文章：<{$postinfo.title}><{/block}>

<{block name = body}>
<div class="col-md-9">
    <div class="panel panel-default">
        <div class="panel-heading">
            修改文章信息
        </div>
        <div class="panel-body">
            <form class="form-horizontal">
                <br>
                <div class="form-group">
                    <label class="col-md-3 control-label">文章标题：</label>
                    <div class="col-md-7" style="margin-left: -14px">
                        <input class="form-control" type="text" name="title" value="<{$postinfo.title}>">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">文章分类：</label>
                    <div class="col-md-3" style="margin-left: -14px;">
                        <select class="form-control" id="firstcatalog">
                            <option>1级目录1</option>
                            <option>1级目录2</option>
                            <option>1级目录3</option>
                        </select>
                    </div>
                    <div class="col-md-3" style="margin-left: -20px;">
                        <select class="form-control" name="secondcatalog">
                            <option>2级目录1</option>
                            <option>2级目录2</option>
                            <option>2级目录3</option>
                        </select>
                    </div>
                    <div class="col-md-3" style="margin-left: -20px;">
                        <select class="form-control" name="thirdcatalog">
                            <option>3级目录1</option>
                            <option>3级目录2</option>
                            <option>3级目录3</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">文章作者：</label>
                    <p class="form-control-static"> <{$postinfo.author}></p>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">文章状态：</label>
                    <p class="form-control-static"> <{$postinfo.status}></p>
                    <div class="col-md-offset-5 col-sm-offset-5" style="margin-top: -32px">
                        <button class="btn btn-sm btn-default" type="button" id="frozen"> 封 禁 </button>
                        <button class="btn btn-sm btn-default" type="button" id="unfrozen"> 解 封 </button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">文章内容：</label>
                    <button id="changecontent" class="btn btn-default" type="button">点击修改文章内容</button>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">文章创建时间：</label>
                    <p class="form-control-static"> <{$postinfo.created}></p>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">最后更改时间：</label>
                    <p class="form-control-static"> <{$postinfo.updated}></p>
                </div>
                <div class="col-md-3 col-md-offset-8 col-sm-offset-8">
                    <button id="save" class="btn btn-danger" type="button">确认并保存修改</button>
                </div>
            </form>
        </div>
    </div>
</div>
<{/block}>

<{block name = js}>
<script>
$("#frozen").click(function() {
    layer.confirm('请确认是否封禁？', {
        btn: ['确认','取消']
    }, function() {
        var postId = "<{$postinfo.a_id}>";
        $.ajax({
            url: "/coc/post/frozen",
            dataType: "json",
            type: "POST",
            data: { "a_id" : postId },
            success: function(data){
                var ret = data.ret;
                if (ret == 0) {
                    window.location.reload();
                } else {
                    layer.msg('操作失败！请重试');
                }
            },
            error: function() {
                layer.msg("请求失败！");
            }
        });
    }, function(){
        layer.msg("已取消");
    });
});

$("#unfrozen").click(function() {
    layer.confirm('请确认是否解封？', {
        btn: ['确认','取消']
    }, function() {
        var postId = "<{$postinfo.a_id}>";
        $.ajax({
            url: "/coc/post/unfrozen",
            dataType: "json",
            type: "POST",
            data: { "a_id" : postId },
            success: function(data){
                var ret = data.ret;
                if (ret == 0) {
                    window.location.reload();
                } else {
                    layer.msg('操作失败！请重试');
                }
            },
            error: function() {
                layer.msg("请求失败！");
            }
        });
    }, function(){
        layer.msg("已取消");
    });
});

$("#changecontent").click(function() {
    var postId = "<{$postinfo.a_id}>";
    layer.open({
      type: 2,
      title: '更改文章内容',
      maxmin: true,
      shadeClose: true,
      area : ['800px' , '580px'],
      content: '/coc/post/updatePostContent?a_id='+postId
    });
});

$("#save").click(function() {
    var postId = "<{$postinfo.a_id}>";
    var title = $("input[name='title']").val();
    var firstCatalog = $("#firstcatalog").find("option:selected").text();
    var secondCatalog = $("#secondcatalog").find("option:selected").text();
    var thirdCatalog = $("#thirdcatalog").find("option:selected").text();

    if ( title == "") {
        layer.msg('请输入文章标题！');
    } else {
        layer.confirm('请确认是否保存修改？', {
        btn: ['确认','取消']
        }, function() {
            $.ajax({
                url: "/coc/post/updatePostInfo",
                type: "POST",
                data: {
                    "a_id": postId,
                    "title": title,
                    "firstcatalog": firstCatalog,
                    "secondcatalog": secondCatalog,
                    "thirdcatalog": thirdCatalog
                },
                dataType: "json",
                success: function(data){
                    var ret = data.ret;
                    if(ret == 0) {
                        layer.msg('操作成功！正在跳转为上一页面', {
                            time: 2000
                        }, function() {
                            $(location).attr('href', '/coc/post/list');
                        });
                    } else {
                        layer.msg('操作失败！请重试');
                    }
                },
                error: function() {
                    layer.msg("请求失败！");
                }
            });
        },function() {
            layer.msg('已取消');
        });
    }
});
</script>

<{/block}>







